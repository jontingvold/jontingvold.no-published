<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width"><title>Hydrological modeling with a simple LSTM network of 30 units (Jon Tingvold)</title><meta name="description" content=""><link rel="preload" as="font" crossorigin href="/assets/fonts/Minion Pro/Minion Pro Regular.woff2"><link rel="preload" as="font" crossorigin href="/assets/fonts/Gill Sans/GillSans.woff2"><link rel="preload" as="font" crossorigin href="/assets/fonts/Minion Pro/Minion Pro Regular Italic.woff2"><link rel="preload" as="font" crossorigin href="/assets/fonts/Minion Pro/Minion Pro Semibold.woff2"> <script>performance.mark('css:block');</script><link rel="stylesheet" href="/assets/styles.css?v=1.0.1"> <script>performance.mark('css:unblock');</script><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="shortcut icon" href="/favicon.ico"><meta name="msapplication-TileColor" content="#000000"><meta name="theme-color" content="#000000"><meta name="application-name" content="Jon Tingvold"><link rel="manifest" href="/site.webmanifest"><link rel="alternate" type="application/atom+xml" title="Jon Tingvold" href="/feed.atom.xml"><link rel="sitemap" type="application/xml" title="sitemap" href="/sitemap.xml" /></head><body><div id="body" class=" divide-paragraphs-by-idention"><div id="leftsidebar"><nav id="toc"><ul class="nav"><li class=" toc-h2"><a href="#abstract">Abstract</a></li><li class=" toc-h2"><a href="#1-introduction">1  Introduction</a></li><li class=" toc-h2"><a href="#2-method">2  Method</a><ul><li class=" toc-h3"><a href="#21-model">2.1  Model</a></li><li class=" toc-h3"><a href="#22-code">2.2  Code</a></li><li class=" toc-h3"><a href="#23-optimization">2.3  Optimization</a></li><li class=" toc-h3"><a href="#24-dataset">2.4  Dataset</a></li></ul></li><li class=" toc-h2"><a href="#3-results">3  Results</a><ul><li class=" toc-h3"><a href="#31-training-experience">3.1  Training experience</a></li><li class=" toc-h3"><a href="#32-r2nash-sutcliffe-efficiency">3.2  R2/Nash-Sutcliffe efficiency</a></li><li class=" toc-h3"><a href="#33-training-set">3.3  Training set</a></li><li class=" toc-h3"><a href="#34-validation-set">3.4  Validation set</a></li></ul></li><li class=" toc-h2"><a href="#4-discussion">4  Discussion</a></li><li class=" toc-h2"><a href="#5-conclusion">5  Conclusion</a></li><li class=" toc-h2"><a href="#references">References</a></li></ul></nav></div><div id="page"><nav id="breadcrumbs" class="hideprint"><div class="container"><div> <a href="/" title="Go to home">jontingvold.no</a> <span class="divider">&nbsp;//&nbsp;</span> <a href="/articles/"> Articles</a> <span class="divider">&nbsp;//&nbsp;</span> Hydrological modeling with a simple LSTM network of 30 units</div></div></nav><div id="pagepage"><main role="main" class="container"><div class="kicker">Mini research</div><h1>Hydrological modeling with a simple LSTM network of 30 units</h1><h2 id="abstract">Abstract</h2><p>Are neural networks the future of hydrological modeling? Maybe. This simple <span class="allsmallcaps">LSTM</span> is in many ways a poor model; yet, it performs remarkably well. On the small 15-year dataset included, it archives a Nash–Sutcliffe efficiency/<span class="allsmallcaps">R2</span> of 0.74 on the 3-year validation part (where 0.00 is the trivial mean prediction and 1.00 is perfect prediction). On the same validation set, my own <span class="allsmallcaps">HBV</span> implementation, <a href="https://github.com/jontingvold/swift-hbv">Swift<span class="allsmallcaps">HBV</span></a>, archives 0.78. It still much left to beat <span class="allsmallcaps">HBV</span>, especially its robustness. However, <span class="allsmallcaps">LSTM</span> was never designed for numerical predictions. Its range contrained units and non-conserved water flow, makes it unnecessary hard to learn hydrological behavior. A special designed <span class="allsmallcaps">RNN</span> architecture might perform a lot better.</p><h2 id="1-introduction">1  Introduction</h2><p>There have been some papers out there that have tried to model rainfall-runoff and sometimes snow storage with <span class="allsmallcaps">LSTM</span> neural networks. For instance Kratzert et al. (2018)<sup id="fnref:1" role="doc-noteref"><a href="#fn:1" class="footnote">1</a></sup> who archives a median Nash–Sutcliffe efficiency/<span class="allsmallcaps">R2</span> of 0.65 on 250 catchments in the US, -0.03 less than a traditional <span class="allsmallcaps">SAC</span>-<span class="allsmallcaps">SMA</span>+<span class="allsmallcaps">SNOW</span>17 model. The results seem good, but not jet as good as old fashion models, like <span class="allsmallcaps">SAC</span>-<span class="allsmallcaps">SMA</span>+<span class="allsmallcaps">SNOW</span>17 or <span class="allsmallcaps">HBV</span>, which also are more robust.</p><p>This was a quick model I through together to see for myself how good these models perform compare to <span class="allsmallcaps">HBV</span>. In difference to <span class="allsmallcaps">HBV</span>, this model has no catchment parameters and generally no assumptions about the world. It should, therefore, be harder to fit than <span class="allsmallcaps">HBV</span>—especially for small datasets, like the one I used. On the other hand, are they not constrained by <span class="allsmallcaps">HBV</span>’s simplistic model of the world.</p><h4 id="a-poor-model">A poor model</h4><p>I many ways are <span class="allsmallcaps">LSTM</span> networks a poor model for hydrology. <span class="allsmallcaps">LSTM</span> was created to model more fuzzy binary problems like natural language processing. While the memory cells can have arbitrary values, the inputs/outputs to/from them are constrained to the [-1, 1] domain with <code class="highlighter-rouge">tanh</code> activation functions. To be able to handle rare floods, hydrological models should not constraint large inputs or outputs.</p><p>The second problem is that <span class="allsmallcaps">LSTM</span> has forget gates and add/subtract gates. Generally, we would like to have models where water is passed around from input, to different internal (storage) cells, between (storage) cells and then to output, without water being created or lost, except for the correction of precipitation at the input and a separate evaporation output that could be monitored.</p><p>These problems do not make <span class="allsmallcaps">LSTM</span> inherently unusable. <span class="allsmallcaps">LSTM</span>s are general computation machines that should theoretically be able to compute anything, given enough units. The problem is just that they might be unnecessary hard to train.</p><h2 id="2-method">2  Method</h2><h3 id="21-model">2.1  Model</h3><p>The model is a simple <span class="allsmallcaps">LSTM</span> with one layer and 30 units, plus one output layer with ReLU activation.</p><h3 id="22-code">2.2  Code</h3><p>Code and data can be found on <a href="https://nbviewer.jupyter.org/github/jontingvold/datascience-projects/blob/master/Hydrological%20modeling%20with%20a%20simple%20LSTM%20network%20of%2030%20units/Hydrological%20modeling%20with%20a%20simple%20LSTM%20network%20of%2030%20units.ipynb">Github</a>.</p><h3 id="23-optimization">2.3  Optimization</h3><ul><li>Adam is used for optimization with a learning rate of 0.00001</li><li>The sequence length is 30 time steps (days) and batch size 1. Thus the error is back propagated 30 time steps and parameters are updated without batching.</li><li>The internal state is reset every epoch (12 years). It can therefore learn dependencies longer than 30 days.</li><li>The loss function is mean squared error on the discharge. There is no explicit optimization of the accumulated discharge.</li></ul><h3 id="24-dataset">2.4  Dataset</h3><p>I used a short 15-years dataset from Hagabru, a discharge station in the Gaula river system, south of Trondheim (Norway). This catchment has a big area of 3059,5 km2 and no lakes to dampen responses. The first 12-years are used as training set, the last 3 years as validation set.</p><h2 id="3-results">3  Results</h2><h3 id="31-training-experience">3.1  Training experience</h3><ul><li>Normalize inputs and outputs between 0.0–1.0 seems to have a big effect on how fast optimization converges, but not prediction performance. Since the <span class="allsmallcaps">LSTM</span> layers outputs are between -1 to +1, the dense layer has to increase their weights. It seems to take a lot of time before these weights are fully learned.</li><li>Increasing the number of <span class="allsmallcaps">LSTM</span>-units seems to have a modest effect on performance after 30 neurons on the small dataset.</li><li>Two <span class="allsmallcaps">LSTM</span>-layers gave the same fit on the training set and slightly worse on the validation set. It might increase a bit with a bigger dataset, but I don’t think it is very beneficial with many layers for hydrological models.</li><li>Normal <span class="allsmallcaps">SGD</span> Nesterov with momentum seems to converge extremely poorly compared with Adam. I have no explanation for why.</li><li>I tried to put accumulated discharge in the loss/objective/cost function, but this just led to models that cap peaks and smoothens the discharge rate. R2 was reduced to 0.54 on the validation set.</li><li>I tried ReLU as activation function, but convergence failed and outputs produced NaNs. Not sure why, but ReLUs are uncommon for <span class="allsmallcaps">LSTM</span>, so it might be that ReLUs make values explode and convergence unstable.</li></ul><h3 id="32-r2nash-sutcliffe-efficiency">3.2  R2/Nash-Sutcliffe efficiency</h3><table><caption>R2/Nash-Sutcliffe efficiency</caption><thead><tr><th>Dataset</th><th><span class="allsmallcaps">LSTM</span></th><th><span class="allsmallcaps">HBV</span></th></tr></thead><tbody><tr><td>Traning set</td><td>0.82</td><td>0.78</td></tr><tr><td>Validation set</td><td>0.74</td><td>0.78</td></tr></tbody><tfoot><tr><td colspan="10">Here 0.0 is the trivial mean prediction and 1.0 is perfect prediction</td></tr></tfoot></table><p>The <span class="allsmallcaps">LSTM</span> network is generally not much behind the <span class="allsmallcaps">HBV</span> model. It performs four percentage points, or 20% worse than the <span class="allsmallcaps">HBV</span> model. However, the <span class="allsmallcaps">LSTM</span> model is less robust. <span class="allsmallcaps">HBV</span> performs equally well on the validation set as the training set, while the <span class="allsmallcaps">LSTM</span> model performs 8 percentage points worse.</p><h3 id="33-training-set">3.3  Training set</h3><figure class="zoomable fullwidth"><div class="imagecontainer-outer" style="width:1072.0px;max-width:100%;margin-left:auto;margin-right:auto;"><div class="imagecontainer" style="padding-bottom: 32.74%;"> <img class="lazyload lazyload-not-loaded" src="/post-assets-resized-80/Train-0.png" data-srcset=" /post-assets-resized-80/Train-0.png 80w, /post-assets-resized-730/Train-0.png 730w, /post-assets-resized-1460/Train-0.png 1460w, /post-assets-resized-1080/Train-0.png 1080w, /post-assets/2019-11-01-test-of-lstm-for-hydrology/Train-0.png 2144w" sizes="(min-width: 730px) 730px, 100vw" data-original="/post-assets/2019-11-01-test-of-lstm-for-hydrology/Train-0.png" data-zooming-width="1600" data-zooming-height="524" alt="" /></div></div></figure><figure class="zoomable fullwidth"><div><div class="imagecontainer-outer" style="width:1071.5px;max-width:100%;margin-left:auto;margin-right:auto;"><div class="imagecontainer" style="padding-bottom: 32.71%;"> <img class="lazyload lazyload-not-loaded" src="/post-assets-resized-80/Train-1.png" data-srcset=" /post-assets-resized-80/Train-1.png 80w, /post-assets-resized-730/Train-1.png 730w, /post-assets-resized-1460/Train-1.png 1460w, /post-assets-resized-1080/Train-1.png 1080w, /post-assets/2019-11-01-test-of-lstm-for-hydrology/Train-1.png 2143w" sizes="(min-width: 730px) 730px, 100vw" data-original="/post-assets/2019-11-01-test-of-lstm-for-hydrology/Train-1.png" data-zooming-width="1600" data-zooming-height="523" alt="" /></div></div><div class="imagecontainer-outer" style="width:1071.5px;max-width:100%;margin-left:auto;margin-right:auto;"><div class="imagecontainer" style="padding-bottom: 32.76%;"> <img class="lazyload lazyload-not-loaded" src="/post-assets-resized-80/Train-2.png" data-srcset=" /post-assets-resized-80/Train-2.png 80w, /post-assets-resized-730/Train-2.png 730w, /post-assets-resized-1460/Train-2.png 1460w, /post-assets-resized-1080/Train-2.png 1080w, /post-assets/2019-11-01-test-of-lstm-for-hydrology/Train-2.png 2143w" sizes="(min-width: 730px) 730px, 100vw" data-original="/post-assets/2019-11-01-test-of-lstm-for-hydrology/Train-2.png" data-zooming-width="1600" data-zooming-height="524" alt="" /></div></div><div class="imagecontainer-outer" style="width:1071.5px;max-width:100%;margin-left:auto;margin-right:auto;"><div class="imagecontainer" style="padding-bottom: 32.8%;"> <img class="lazyload lazyload-not-loaded" src="/post-assets-resized-80/Train-3.png" data-srcset=" /post-assets-resized-80/Train-3.png 80w, /post-assets-resized-730/Train-3.png 730w, /post-assets-resized-1460/Train-3.png 1460w, /post-assets-resized-1080/Train-3.png 1080w, /post-assets/2019-11-01-test-of-lstm-for-hydrology/Train-3.png 2143w" sizes="(min-width: 730px) 730px, 100vw" data-original="/post-assets/2019-11-01-test-of-lstm-for-hydrology/Train-3.png" data-zooming-width="1600" data-zooming-height="525" alt="" /></div></div></div></figure><figure class="zoomable fullwidth"><div class="imagecontainer-outer" style="width:1071.5px;max-width:100%;margin-left:auto;margin-right:auto;"><div class="imagecontainer" style="padding-bottom: 19.32%;"> <img class="lazyload lazyload-not-loaded" src="/post-assets-resized-80/Train-4.png" data-srcset=" /post-assets-resized-80/Train-4.png 80w, /post-assets-resized-730/Train-4.png 730w, /post-assets-resized-1460/Train-4.png 1460w, /post-assets-resized-1080/Train-4.png 1080w, /post-assets/2019-11-01-test-of-lstm-for-hydrology/Train-4.png 2143w" sizes="(min-width: 730px) 730px, 100vw" data-original="/post-assets/2019-11-01-test-of-lstm-for-hydrology/Train-4.png" data-zooming-width="1600" data-zooming-height="309" alt="" /></div></div></figure><h3 id="34-validation-set">3.4  Validation set</h3><figure class="zoomable fullwidth"><div class="imagecontainer-outer" style="width:1071.5px;max-width:100%;margin-left:auto;margin-right:auto;"><div class="imagecontainer" style="padding-bottom: 32.8%;"> <img class="lazyload lazyload-not-loaded" src="/post-assets-resized-80/Val-5.png" data-srcset=" /post-assets-resized-80/Val-5.png 80w, /post-assets-resized-730/Val-5.png 730w, /post-assets-resized-1460/Val-5.png 1460w, /post-assets-resized-1080/Val-5.png 1080w, /post-assets/2019-11-01-test-of-lstm-for-hydrology/Val-5.png 2143w" sizes="(min-width: 730px) 730px, 100vw" data-original="/post-assets/2019-11-01-test-of-lstm-for-hydrology/Val-5.png" data-zooming-width="1600" data-zooming-height="525" alt="" /></div></div></figure><figure class="zoomable fullwidth"><div><div class="imagecontainer-outer" style="width:1071.5px;max-width:100%;margin-left:auto;margin-right:auto;"><div class="imagecontainer" style="padding-bottom: 32.76%;"> <img class="lazyload lazyload-not-loaded" src="/post-assets-resized-80/Val-6.png" data-srcset=" /post-assets-resized-80/Val-6.png 80w, /post-assets-resized-730/Val-6.png 730w, /post-assets-resized-1460/Val-6.png 1460w, /post-assets-resized-1080/Val-6.png 1080w, /post-assets/2019-11-01-test-of-lstm-for-hydrology/Val-6.png 2143w" sizes="(min-width: 730px) 730px, 100vw" data-original="/post-assets/2019-11-01-test-of-lstm-for-hydrology/Val-6.png" data-zooming-width="1600" data-zooming-height="524" alt="" /></div></div><div class="imagecontainer-outer" style="width:1071.5px;max-width:100%;margin-left:auto;margin-right:auto;"><div class="imagecontainer" style="padding-bottom: 32.71%;"> <img class="lazyload lazyload-not-loaded" src="/post-assets-resized-80/Val-7.png" data-srcset=" /post-assets-resized-80/Val-7.png 80w, /post-assets-resized-730/Val-7.png 730w, /post-assets-resized-1460/Val-7.png 1460w, /post-assets-resized-1080/Val-7.png 1080w, /post-assets/2019-11-01-test-of-lstm-for-hydrology/Val-7.png 2143w" sizes="(min-width: 730px) 730px, 100vw" data-original="/post-assets/2019-11-01-test-of-lstm-for-hydrology/Val-7.png" data-zooming-width="1600" data-zooming-height="523" alt="" /></div></div><div class="imagecontainer-outer" style="width:1071.5px;max-width:100%;margin-left:auto;margin-right:auto;"><div class="imagecontainer" style="padding-bottom: 32.71%;"> <img class="lazyload lazyload-not-loaded" src="/post-assets-resized-80/Val-8.png" data-srcset=" /post-assets-resized-80/Val-8.png 80w, /post-assets-resized-730/Val-8.png 730w, /post-assets-resized-1460/Val-8.png 1460w, /post-assets-resized-1080/Val-8.png 1080w, /post-assets/2019-11-01-test-of-lstm-for-hydrology/Val-8.png 2143w" sizes="(min-width: 730px) 730px, 100vw" data-original="/post-assets/2019-11-01-test-of-lstm-for-hydrology/Val-8.png" data-zooming-width="1600" data-zooming-height="523" alt="" /></div></div></div></figure><figure class="zoomable fullwidth"><div class="imagecontainer-outer" style="width:1071.5px;max-width:100%;margin-left:auto;margin-right:auto;"><div class="imagecontainer" style="padding-bottom: 19.37%;"> <img class="lazyload lazyload-not-loaded" src="/post-assets-resized-80/Val-9.png" data-srcset=" /post-assets-resized-80/Val-9.png 80w, /post-assets-resized-730/Val-9.png 730w, /post-assets-resized-1460/Val-9.png 1460w, /post-assets-resized-1080/Val-9.png 1080w, /post-assets/2019-11-01-test-of-lstm-for-hydrology/Val-9.png 2143w" sizes="(min-width: 730px) 730px, 100vw" data-original="/post-assets/2019-11-01-test-of-lstm-for-hydrology/Val-9.png" data-zooming-width="1600" data-zooming-height="310" alt="" /></div></div></figure><h4 id="rainfall-events">Rainfall events</h4><ul><li>It seems to estimate the peak size after rainfall events quite well, perhaps slightly better than <span class="allsmallcaps">HBV</span>.</li><li>The discharge falls a bit weird. It seems to fall linearly with lots of breaks. It should fall like exponential decay, where the decay is larger for/after big rainfall events.</li><li>It seems like the model has a maximal discharge rate. Large peaks are underestimated and simulated peaks have ca. the same value.</li></ul><h4 id="snowmelt">Snowmelt</h4><ul><li>The model struggles with spring melt when the temperature is near zero, for instance in March and April 2014, and March 2012. When the temperature is high, like in June 2012, the estimates are good. Snowmelt around zero is something all hydrological models struggle with because snowmelt is affected not only by temperature, but also wind, humidity and in-/outgoing radiation (e.g. clear nights). It still performs worse than <span class="allsmallcaps">HBV</span>, but the <span class="allsmallcaps">HBV</span> is configured with the elevation distribution of the catchment and the estimated temperature on different elevations, while the <span class="allsmallcaps">LSTM</span>-network needs to learn it, so it should perform worse.</li><li>It seems to be able to learn to store snow, but it is hard to know how accurately it records and store snow levels. The model seems to output more water after winters with more precipitation, and it looks like the accumulated discharge is neither severely over- or underestimated during spring melt the two first years in the validation set. However, in 2014 the discharge is way too high over time.</li></ul><h2 id="4-discussion">4  Discussion</h2><ul><li>The performance looks quite good compared to the simple, poor model and short time series. It is quite amazing how well it behaves from being trained on only 4380 time steps and that it learns quite well to store snow over long periods.</li><li>The reason it underestimates peaks is probably because of the <code class="highlighter-rouge">tanh</code> activation functions. It is not the biggest problem, but it probably makes <span class="allsmallcaps">LSTM</span> unusable to estimate (rare) flood events. A different <span class="allsmallcaps">RNN</span> architecture could perhaps solve this.</li><li>It is hard to know how accurate the model store snow levels. However, it is probably far away from <span class="allsmallcaps">HBV</span>. The model would likely benefit from a more constraint model when it comes to adding and subtracting water from memory cells.</li><li>The problem that discharge rates do not smoothly decay after rainfall events, might be an artifact by how <span class="allsmallcaps">LSTM</span> networks work. <span class="allsmallcaps">LSTM</span> networks should be able to model exponential decay. However it requires that the cell units have values around 0.5 (so they neither are limited the tanh activation functions, or they are close to zero and produce small outputs), the activation layer needs produce outputs near 0, so the sigmoids produce output near 0.5 and decent decaying factors, and the outputs should into the forget gates on the next time step and remove the same amount of water from the cell states that was outputted. It is a lot to demand that <span class="allsmallcaps">LSTM</span> networks should learn this accurately, and the fact that it does not look like it does might mean that <span class="allsmallcaps">LSTM</span> networks are poor at accurately modeling snow levels, and get proper decaying outputting from storage cells.</li><li>Even if <span class="allsmallcaps">LSTM</span> model had performed similarly as <span class="allsmallcaps">HBV</span>, the <span class="allsmallcaps">HBV</span> model would be preferred. It is, of course, a lot more robust, and performs almost equally well on the validation set as the training set.</li></ul><h2 id="5-conclusion">5  Conclusion</h2><p>This dataset is too small to get a decent overview of <span class="allsmallcaps">LSTM</span> s performance. However, on this dataset it performs quite well. It is not too much behind <span class="allsmallcaps">HBV</span>, although its predictions are a lot less robust and trustwordy compare to <span class="allsmallcaps">HBV</span>. The <span class="allsmallcaps">LSTM</span> model fails at some places which might indicate that the architecture is not the best, like that the decaying after rainfall events are not very smooth and constrained peaks. It would be interesting to look at other <span class="allsmallcaps">RNN</span> architectures that are more suitable for hydrological modeling.</p><h4 id="is-it-possible-to-create-a-better-model">Is it possible to create a better model?</h4><p>For hydrology, we probably want an <span class="allsmallcaps">RNN</span> network with ReLU gates and where water not lost or created. However, designing new <span class="allsmallcaps">RNN</span> architectures is not the easiest task in the world. <span class="allsmallcaps">LSTM</span> (and the similar <span class="allsmallcaps">GRU</span>) has been the default architecture because it is difficult to create <span class="allsmallcaps">RNN</span> models. <span class="allsmallcaps">LSTM</span> was carefully designed to make training stable and avoid the vanishing gradient problem and be able to propagate errors over long time frames. I have tried to think of a better model, but probably need to think a bit more seriously, if I should have a chance.</p><p>It would also be interesting to implement <span class="allsmallcaps">HBV</span>, or something similar, in Tensorflow and train it with gradient descent like a neural network. As far as I can see is the only strictly undifferentiable parts in <span class="allsmallcaps">HBV</span> min/max functions, and they are differentiable in practice.</p><p>However, a pure <span class="allsmallcaps">HBV</span> trained with gradient descent might be stuck in local minimas. Local minimas are usually not a problem for neural networks because they have lots of parameters. The chance that all second derivates are all positive is therefore small. <span class="allsmallcaps">HBV</span> has only 16 parameters and is, therefore, more likely to be stuck in local minimas if it’s not trained by algorithms that tackle local minimas.</p><p>The ideal model might be therefore something between <span class="allsmallcaps">HBV</span> and <span class="allsmallcaps">LSTM</span>—a network based on <span class="allsmallcaps">HBV</span>’s tank model, but with more parameters, more freedom, and less linearity. The error in storage cells should also be able to flow freely back in time without degradation to be able to train long term dependencies like snow storage over the winter.</p><h2 id="references" class="footnotes-headline">References</h2><div class="footnotes" role="doc-endnotes"><ol><li id="fn:1" role="doc-endnote"><p>Kratzert, Frederik, Daniel Klotz, Claire Brenner, Karsten Schulz, and Mathew Herrnegger. “Rainfall–Runoff Modelling Using Long Short-Term Memory (<span class="allsmallcaps">LSTM</span>) Networks.” Hydrology and Earth System Sciences 22, no. 11 (November 22, 2018): 6005–22. <a href="https://doi.org/10.5194/hess-22-6005-2018">https://doi.org/10.5194/hess-22-6005-2018</a>. <a href="#fnref:1" class="reversefootnote" role="doc-backlink">&#8617;</a></p></li></ol></div><div class="copyrightnotice"> <span class="only-print">Source: <a href="https://www.jontingvold.no/articles/test-of-lstm-for-hydrology.html">https://www.jontingvold.no/articles/test-of-lstm-for-hydrology.html</a><br></span> &copy;2019&nbsp; Jon Tingvold, Norway. All rights reserved.<br> Last updated Jun 5, 2020</div></main></div></div></div></body><script>performance.mark('javascript:block');</script><style>#instantclick {display: none;}</style><script src="/assets/javascript/instantclick.min.js" data-no-instant></script> <script src="/assets/javascript/jquery.min.js" data-no-instant></script> <script src="/assets/javascript/bootstrap.min.js" data-no-instant></script> <script data-no-instant> function scrollIntoViewX(scrollingElement, elementTop, scrollerTop, scrollerBottom, evenIfVisible) { const offset = 100; /* px */ const animation_time = 150; /* ms */ const isVisible = (elementTop >= scrollerTop && elementTop <= (scrollerBottom - 100)); if (!isVisible || evenIfVisible) { $(scrollingElement).animate({ scrollTop: elementTop - offset }, animation_time); } } function scrollIntoView(scrollingElement, scrollToElement, evenIfVisible) { const elementTop = scrollToElement.offsetTop; const scrollerTop = scrollingElement.scrollTop; const scrollerBottom = scrollerTop + $(scrollingElement).innerHeight(); scrollIntoViewX(scrollingElement, elementTop, scrollerTop, scrollerBottom, evenIfVisible); } function scrollWindowIntoView(scrollToElement, evenIfVisible) { const elementTop = scrollToElement.offsetTop; const scrollerTop = window.scrollY; const scrollerBottom = scrollerTop + window.innerHeight; scrollIntoViewX('html, body', elementTop, scrollerTop, scrollerBottom, evenIfVisible); } function enhanceAnchorLinks() { $(document).ready(function() { $("#toc a[href^='#']").click(function (event) { const idWithHash = $(this).attr('href'); const scrollToElement = document.getElementById(idWithHash.substring(1)); scrollWindowIntoView(scrollToElement, true); event.stopPropagation(); return false; }); }); } InstantClick.on('change', () => { $('body').scrollspy({ target: '#toc', offset: 130 }); enhanceAnchorLinks(); }); /* DISABLED: BFCACHE AND SCROLL POSITION RESTORATION DOES NOT WORK WITH SCROLLABLE DIVS $('#toc').on('activate.bs.scrollspy', function (event) { scrollIntoView(document.querySelector("#toc .nav"), event.target, false); }); */ </script><style> @media screen and (max-width: 1000px) { img {box-shadow: none;} }</style><script src="/assets/javascript/lozad.min.js" data-no-instant></script> <script data-no-instant> const observer = lozad('.lazyload', { rootMargin: '200px', threshold: 0.1, loaded: function(el) { /*el.src = el.getAttribute('data-original'); /* Preper for zooming */ el.classList.remove('lazyload-not-loaded'); } }); window.addEventListener("beforeprint", (event) => { let elements = document.querySelectorAll('.lazyload'); elements.forEach(element => {observer.triggerLoad(element);}); }); InstantClick.on('change', () => { observer.observe(); }); </script> <script src="/assets/javascript/zooming.min.js" data-no-instant></script> <script> /* https://github.com/kingdido999/zooming */ if (window.innerWidth > 1000) { var zooming = new Zooming({ enableGrab: false, /* Does not work*/ bgOpacity: 1.0, bgColor: "rgb(255, 255, 255)", transitionDuration: 0.7, scaleBase: 0.7, customSize: '100%', onBeforeOpen: function() { imageContainers = document.querySelectorAll('figure.zoomable .imagecontainer'); imageContainers.forEach(imageContainer => {imageContainer.style.overflow = "visable"}); images = document.querySelectorAll('figure.zoomable img'); images.forEach(image => {image.src = ""}); } }).listen('img.zoomable, figure.zoomable img'); } </script> <!--<script src="http://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js" data-no-instant></script> <script src="//cdnjs.cloudflare.com/ajax/libs/jquery-throttle-debounce/1.1/jquery.ba-throttle-debounce.min.js" data-no-instant></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/fluidbox/2.0.5/js/jquery.fluidbox.min.js" data-no-instant></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fluidbox/2.0.5/css/fluidbox.min.css"> <script data-no-instant> InstantClick.on('change', () => { $('a.lightbox').fluidbox({ viewportFill: 0.8, maxWidth: 1600, loader: true }); $('a.lightbox').css('cursor', 'zoom-in'); }); </script>--> <script data-no-instant>InstantClick.init();</script> <script>performance.mark('javascript:unblock');</script> <script type="text/javascript" data-no-instant> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','https://www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-9010257-2', 'auto'); ga('send', 'pageview'); // Track JS performance if (window.performance) { var timeSincePageLoad_ms = performance.now() var timeSincePageLoad_ms_int = Math.round(timeSincePageLoad_ms) ga('send', 'timing', 'JS Dependencies', 'load', timeSincePageLoad_ms_int); } // Track page views with InstantClick SinglePageApplication InstantClick.on('change', function() { ga('send', 'pageview', location.pathname + location.search); }); </script> <script> var redirectTime = performance.timing.redirectEnd - performance.timing.redirectStart; var dnsLookupTime = performance.timing.domainLookupEnd - performance.timing.domainLookupStart; var tcpConnectTime = performance.timing.connectEnd - performance.timing.connectStart; var connectTime = performance.timing.responseEnd - performance.timing.requestStart; var renderTime = performance.timing.domComplete - performance.timing.domLoading; var totalPageLoadTime = performance.timing.loadEventEnd - performance.timing.navigationStart; ga('send', 'timing', 'Redirect time', 'Redirect', redirectTime); ga('send', 'timing', 'DNS lookup time', 'unblock', dnsLookupTime); ga('send', 'timing', 'TCP connect time', 'unblock', tcpConnectTime); ga('send', 'timing', 'Rendering time', 'unblock', renderTime); ga('send', 'timing', 'Total page load time', 'unblock', totalPageLoadTime); if (performance.getEntriesByName("first-paint").length > 0) { const firstPaintTime = performance.getEntriesByName("first-paint")[0].startTime; ga('send', 'timing', 'First paint time', 'unblock', firstPaintTime); } if (performance.getEntriesByName("first-paint").length > 0) { const firstPaintTime = performance.getEntriesByName("first-paint")[0].startTime; ga('send', 'timing', 'First paint time', 'unblock', firstPaintTime); } if (performance.getEntriesByName("first-contentful-paint").length > 0) { const firstContentfulPaintTime = performance.getEntriesByName("first-contentful-paint")[0].startTime; ga('send', 'timing', 'First contentful paint time', 'unblock', firstContentfulPaintTime); } //ga('send', 'timing', 'CSS', 'start-block', performance.measure("css-rendering-time", 'css:block').startTime); ga('send', 'timing', 'CSS', 'blocked', performance.measure("css-rendering-time", 'css:block', 'css:unblock').duration); //ga('send', 'timing', 'Javascript', 'blocked', performance.measure("javascript-rendering-time", 'javascript:block').startTime); ga('send', 'timing', 'Javascript', 'blocked', performance.measure("javascript-rendering-time", 'javascript:block', 'javascript:unblock').duration); </script></html>
